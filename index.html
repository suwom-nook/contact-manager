<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¸ë§¥ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Noto+Serif+KR:wght@400;600&display=swap');
  :root {
    --bg:#0d1117; --bg2:#161b22; --bg3:#1c2333; --bg4:#21262d;
    --border:#30363d; --border2:#3d4450;
    --text:#e6edf3; --text2:#8b949e; --text3:#6e7681;
    --accent:#58a6ff; --accent2:#1f6feb;
    --green:#3fb950; --red:#f85149; --yellow:#d29922;
    --purple:#bc8cff; --orange:#e3b341; --teal:#39d353;
    --card-shadow:0 8px 32px rgba(0,0,0,.4);
    --radius:10px;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;}

  .topbar{background:var(--bg2);border-bottom:1px solid var(--border);padding:0 24px;height:56px;display:flex;align-items:center;gap:16px;position:sticky;top:0;z-index:200;}
  .topbar-logo{font-family:'Noto Serif KR',serif;font-size:17px;font-weight:600;color:var(--accent);white-space:nowrap;}
  .topbar-search{flex:1;max-width:480px;position:relative;}
  .topbar-search input{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:7px 12px 7px 34px;color:var(--text);font-size:13px;font-family:inherit;outline:none;transition:border-color .2s;}
  .topbar-search input:focus{border-color:var(--accent2);}
  .topbar-search input::placeholder{color:var(--text3);}
  .search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text3);font-size:14px;pointer-events:none;}
  .topbar-actions{margin-left:auto;display:flex;gap:8px;}

  .btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:6px;font-size:13px;font-family:inherit;font-weight:500;cursor:pointer;border:1px solid var(--border);background:var(--bg4);color:var(--text);transition:all .15s;white-space:nowrap;}
  .btn:hover{background:var(--bg3);border-color:var(--border2);}
  .btn-primary{background:var(--accent2);border-color:transparent;color:#fff;}
  .btn-primary:hover{background:#388bfd;}
  .btn-green{background:rgba(63,185,80,.15);border-color:var(--green);color:var(--green);}
  .btn-red{background:rgba(248,81,73,.12);border-color:var(--red);color:var(--red);}
  .btn-sm{padding:3px 8px;font-size:11px;}

  .view-tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--border);padding:0 24px;}
  .view-tab{padding:12px 18px;font-size:13px;font-weight:500;cursor:pointer;border:none;background:none;color:var(--text2);font-family:inherit;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .15s;display:flex;align-items:center;gap:5px;}
  .view-tab:hover{color:var(--text);}
  .view-tab.active{color:var(--accent);border-bottom-color:var(--accent);}

  .layout{display:flex;flex:1;height:calc(100vh - 104px);overflow:hidden;}

  .sidebar{width:295px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0;}
  .sidebar-header{padding:12px 14px 10px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
  .sidebar-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text2);}
  .person-count{font-size:11px;background:var(--bg3);border:1px solid var(--border);border-radius:20px;padding:2px 8px;color:var(--text2);}
  .filter-bar{padding:8px 10px;border-bottom:1px solid var(--border);display:flex;flex-direction:column;gap:5px;}
  .filter-row{display:flex;gap:5px;}
  .filter-select{background:var(--bg3);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px;font-family:inherit;padding:5px 8px;width:100%;outline:none;cursor:pointer;}
  .filter-select:focus{border-color:var(--accent2);}

  .person-list{flex:1;overflow-y:auto;padding:4px 0;}
  .person-list::-webkit-scrollbar{width:3px;}
  .person-list::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px;}
  .person-item{display:flex;align-items:center;gap:9px;padding:8px 12px;cursor:pointer;border-left:3px solid transparent;transition:all .15s;}
  .person-item:hover{background:var(--bg3);}
  .person-item.active{background:rgba(31,111,235,.12);border-left-color:var(--accent);}
  .avatar{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;flex-shrink:0;border:2px solid;}
  .person-info{flex:1;min-width:0;}
  .person-name{font-size:13px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .person-meta{font-size:11px;color:var(--text2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px;}
  .influence-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}

  .main{flex:1;overflow-y:auto;display:flex;flex-direction:column;}
  .main::-webkit-scrollbar{width:5px;}
  .main::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px;}

  .detail-view{flex:1;padding:24px 28px;max-width:980px;}
  .detail-hero{display:flex;gap:20px;align-items:flex-start;margin-bottom:22px;}
  .detail-avatar{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;flex-shrink:0;border:3px solid;}
  .detail-name{font-family:'Noto Serif KR',serif;font-size:24px;font-weight:600;margin-bottom:5px;}
  .detail-role{font-size:13px;color:var(--text2);margin-bottom:10px;}
  .tags{display:flex;flex-wrap:wrap;gap:5px;}
  .tag{display:inline-flex;align-items:center;gap:3px;padding:2px 9px;border-radius:20px;font-size:11px;font-weight:500;border:1px solid;}
  .tag-blue{background:rgba(88,166,255,.12);border-color:rgba(88,166,255,.4);color:var(--accent);}
  .tag-green{background:rgba(63,185,80,.12);border-color:rgba(63,185,80,.4);color:var(--green);}
  .tag-yellow{background:rgba(210,153,34,.12);border-color:rgba(210,153,34,.4);color:var(--yellow);}
  .tag-purple{background:rgba(188,140,255,.12);border-color:rgba(188,140,255,.4);color:var(--purple);}
  .tag-red{background:rgba(248,81,73,.12);border-color:rgba(248,81,73,.4);color:var(--red);}

  .section-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin-bottom:16px;}
  .section-title{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--text2);margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;gap:8px;}

  .influence-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:12px;}
  .influence-item{display:flex;flex-direction:column;gap:5px;}
  .influence-label{font-size:12px;color:var(--text2);}
  .influence-bar{height:5px;background:var(--bg3);border-radius:3px;overflow:hidden;}
  .influence-fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.4,0,.2,1);}
  .influence-value{font-size:11px;font-weight:600;display:flex;justify-content:space-between;}

  .events-grid{display:flex;flex-wrap:wrap;gap:8px;}
  .event-badge{display:inline-flex;align-items:center;gap:5px;padding:7px 12px;border-radius:8px;font-size:12px;font-weight:500;cursor:pointer;border:2px solid;transition:all .2s;user-select:none;}
  .event-badge.active{box-shadow:0 0 10px rgba(88,166,255,.2);}
  .event-badge:not(.active){opacity:.4;filter:grayscale(.5);}
  .event-badge:hover{opacity:1;filter:none;}

  .relation-item{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border);}
  .relation-item:last-child{border-bottom:none;}
  .rel-name{width:88px;font-size:13px;font-weight:500;flex-shrink:0;cursor:pointer;color:var(--accent);}
  .rel-name:hover{text-decoration:underline;}
  .closeness-track{flex:1;height:7px;background:var(--bg3);border-radius:4px;cursor:pointer;position:relative;}
  .closeness-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--accent2),var(--purple));transition:width .3s;}
  .closeness-value{width:30px;font-size:11px;font-weight:600;color:var(--text2);text-align:right;}

  .meeting-card{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:9px;border-left:3px solid var(--accent2);}
  .meeting-date{font-size:12px;color:var(--accent);font-weight:600;}
  .meeting-details{display:flex;gap:14px;margin:5px 0;flex-wrap:wrap;}
  .meeting-detail-item{font-size:12px;color:var(--text2);}
  .meeting-memo{font-size:13px;line-height:1.65;background:var(--bg4);border-radius:6px;padding:9px 11px;margin-top:7px;}
  .meeting-eval{margin-top:6px;padding:7px 11px;background:rgba(63,185,80,.08);border:1px solid rgba(63,185,80,.2);border-radius:6px;font-size:12px;color:var(--green);}

  .empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text3);gap:10px;padding:60px;}

  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .2s;}
  .modal-overlay.show{opacity:1;pointer-events:all;}
  .modal{background:var(--bg2);border:1px solid var(--border2);border-radius:14px;padding:26px;width:580px;max-width:96vw;max-height:90vh;overflow-y:auto;transform:translateY(20px);transition:transform .2s;box-shadow:var(--card-shadow);}
  .modal-overlay.show .modal{transform:translateY(0);}
  .modal-title{font-family:'Noto Serif KR',serif;font-size:17px;font-weight:600;margin-bottom:18px;}
  .form-group{margin-bottom:12px;}
  .form-label{display:block;font-size:11px;font-weight:700;color:var(--text2);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;}
  .form-input,.form-textarea,.form-select{width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:7px;padding:8px 11px;color:var(--text);font-size:13px;font-family:inherit;outline:none;transition:border-color .2s;}
  .form-input:focus,.form-textarea:focus,.form-select:focus{border-color:var(--accent2);}
  .form-textarea{resize:vertical;min-height:70px;}
  .form-row{display:flex;gap:9px;}
  .form-row .form-group{flex:1;}
  .modal-footer{display:flex;justify-content:flex-end;gap:8px;margin-top:18px;padding-top:14px;border-top:1px solid var(--border);}
  .star-input{display:flex;gap:3px;}
  .star-btn{font-size:20px;cursor:pointer;transition:transform .1s;background:none;border:none;padding:0;}
  .star-btn:hover{transform:scale(1.15);}

  .grid-view{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:14px;padding:20px;}
  .grid-card{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:16px;cursor:pointer;transition:all .2s;}
  .grid-card:hover{border-color:var(--accent2);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.3);}
  .grid-card-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;}

  .network-view{flex:1;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;}
  .net-tooltip{position:absolute;background:var(--bg4);border:1px solid var(--border2);border-radius:6px;padding:6px 10px;font-size:12px;pointer-events:none;z-index:100;white-space:nowrap;box-shadow:0 4px 12px rgba(0,0,0,.4);display:none;}

  /* â”€â”€ ADMIN â”€â”€ */
  .admin-wrap{flex:1;overflow-y:auto;padding:28px 32px;max-width:940px;}
  .admin-page-title{font-family:'Noto Serif KR',serif;font-size:22px;font-weight:600;margin-bottom:4px;}
  .admin-page-sub{font-size:13px;color:var(--text2);margin-bottom:24px;}
  .admin-sections{display:grid;grid-template-columns:repeat(auto-fill,minmax(390px,1fr));gap:16px;margin-bottom:20px;}
  .admin-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:18px;}
  .admin-card-title{font-size:13px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:6px;}
  .tag-list{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px;min-height:32px;}
  .editable-tag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;background:var(--bg3);border:1px solid var(--border);border-radius:20px;font-size:12px;}
  .del-btn{background:none;border:none;color:var(--text3);cursor:pointer;font-size:15px;line-height:1;padding:0 1px;}
  .del-btn:hover{color:var(--red);}
  .add-tag-row{display:flex;gap:6px;}
  .add-tag-input{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:6px 10px;color:var(--text);font-size:12px;font-family:inherit;outline:none;transition:border-color .2s;}
  .add-tag-input:focus{border-color:var(--accent2);}

  .region-preview-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;}
  .sido-chip{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:8px 12px;font-size:12px;cursor:pointer;transition:border-color .15s;}
  .sido-chip:hover{border-color:var(--accent);}
  .sido-chip.open{border-color:var(--accent);background:rgba(31,111,235,.08);}
  .sido-chip-name{font-weight:600;margin-bottom:3px;}
  .sido-chip-count{color:var(--text3);font-size:11px;}
  .sigungu-list{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;padding:8px;background:var(--bg3);border-radius:6px;max-height:120px;overflow-y:auto;}
  .sigungu-item{font-size:11px;color:var(--text2);padding:2px 7px;background:var(--bg4);border-radius:4px;}

  .divider{height:1px;background:var(--border);margin:18px 0;}
  ::-webkit-scrollbar{width:4px;height:4px;}
  ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px;}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}
  .fade-in{animation:fadeIn .25s ease;}
  .no-results{text-align:center;padding:36px;color:var(--text3);font-size:13px;}
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-logo">ğŸ›ï¸ ì¸ë§¥ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
  <div class="topbar-search">
    <span class="search-icon">ğŸ”</span>
    <input type="text" id="searchInput" placeholder="ì´ë¦„, ì†Œì†, ì§€ì—­, ì •ë‹¹ ê²€ìƒ‰...">
  </div>
  <div class="topbar-actions">
    <button class="btn btn-green" onclick="openAddPersonModal()">ï¼‹ ì¸ë¬¼ ì¶”ê°€</button>
  </div>
</div>

<div class="view-tabs">
  <button class="view-tab active" onclick="switchView('list')" id="tab-list">ğŸ‘¤ ì¸ë¬¼ ëª©ë¡</button>
  <button class="view-tab" onclick="switchView('grid')" id="tab-grid">âŠ ì¹´ë“œ ë³´ê¸°</button>
  <button class="view-tab" onclick="switchView('network')" id="tab-network">ğŸ•¸ ê´€ê³„ë„</button>
  <button class="view-tab" onclick="switchView('admin')" id="tab-admin">âš™ï¸ ê´€ë¦¬ì</button>
</div>

<div class="layout" id="mainLayout">
  <div class="sidebar" id="sidebarEl">
    <div class="sidebar-header">
      <span class="sidebar-title">ì¸ë¬¼</span>
      <span class="person-count" id="personCount">0ëª…</span>
    </div>
    <div class="filter-bar">
      <select class="filter-select" id="filterParty" onchange="applyFilters()">
        <option value="">ì „ì²´ ì •ë‹¹</option>
      </select>
      <div class="filter-row">
        <select class="filter-select" id="filterSido" onchange="onSidoFilter()">
          <option value="">ì „ì²´ ê´‘ì—­</option>
        </select>
        <select class="filter-select" id="filterSigungu" onchange="applyFilters()">
          <option value="">ì „ì²´ ì‹œêµ°êµ¬</option>
        </select>
      </div>
      <select class="filter-select" id="filterRelType" onchange="applyFilters()">
        <option value="">ì „ì²´ ë¶„ë¥˜</option>
      </select>
      <select class="filter-select" id="filterInfluence" onchange="applyFilters()">
        <option value="">ì „ì²´ ì˜í–¥ë ¥</option>
        <option value="5">â­â­â­â­â­ ìµœê³ </option>
        <option value="4">â­â­â­â­ ë†’ìŒ</option>
        <option value="3">â­â­â­ ë³´í†µ</option>
        <option value="2">â­â­ ë‚®ìŒ</option>
        <option value="1">â­ ìµœì €</option>
      </select>
    </div>
    <div class="person-list" id="personList"></div>
  </div>

  <div class="main" id="mainContent">
    <div class="empty-state" id="emptyState">
      <div style="font-size:44px;">ğŸ›ï¸</div>
      <div style="font-size:15px;">ì¸ë¬¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì¶”ê°€í•˜ì„¸ìš”</div>
      <div style="font-size:13px;">ì¢Œì¸¡ ëª©ë¡ì—ì„œ ì¸ë¬¼ì„ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>
    <div id="detailView" style="display:none;"></div>
    <div id="gridView" style="display:none;" class="grid-view"></div>
    <div id="networkView" style="display:none;" class="network-view">
      <canvas id="networkCanvas"></canvas>
      <div class="net-tooltip" id="netTooltip"></div>
    </div>
    <div id="adminView" style="display:none;"></div>
  </div>
</div>

<!-- PERSON MODAL -->
<div class="modal-overlay" id="addPersonModal">
  <div class="modal">
    <div class="modal-title" id="personModalTitle">ğŸ‘¤ ì¸ë¬¼ ì¶”ê°€</div>
    <input type="hidden" id="editPersonId">
    <div class="form-row">
      <div class="form-group"><label class="form-label">ì´ë¦„ *</label><input class="form-input" id="pName" placeholder="í™ê¸¸ë™"></div>
      <div class="form-group"><label class="form-label">ì„±ë³„</label><select class="form-select" id="pSex"><option value="">-</option><option value="ë‚¨">ë‚¨</option><option value="ì—¬">ì—¬</option></select></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">ì†Œì† / ê¸°ê´€</label><input class="form-input" id="pCompany" placeholder="êµ­íšŒì˜ì› ì‚¬ë¬´ì‹¤"></div>
      <div class="form-group"><label class="form-label">ì§ì±…</label><input class="form-input" id="pDuty" placeholder="ë³´ì¢Œê´€"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">ì •ë‹¹</label><select class="form-select" id="pParty"></select></div>
      <div class="form-group"><label class="form-label">ê´€ê³„ ë¶„ë¥˜</label><select class="form-select" id="pRelation"></select></div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ê´‘ì—­ì‹œë„</label>
        <select class="form-select" id="pSido" onchange="onPersonSidoChange()"></select>
      </div>
      <div class="form-group">
        <label class="form-label">ì‹œ Â· êµ° Â· êµ¬</label>
        <select class="form-select" id="pSigungu"></select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">íœ´ëŒ€í°</label><input class="form-input" id="pPhone" placeholder="010-0000-0000"></div>
      <div class="form-group"><label class="form-label">ìƒë…„ì›”ì¼</label><input class="form-input" id="pBirth" type="date"></div>
    </div>
    <div class="form-group"><label class="form-label">ë©”ëª¨</label><textarea class="form-textarea" id="pMemo" placeholder="íŠ¹ì´ì‚¬í•­, ê´€ì‹¬ì‚¬, ë°°ê²½..."></textarea></div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ì •ì¹˜ì  ì˜í–¥ë ¥</label>
        <div class="star-input" id="pPoliticalStars">
          <button class="star-btn" onclick="setPStar('political',1)">â˜†</button><button class="star-btn" onclick="setPStar('political',2)">â˜†</button><button class="star-btn" onclick="setPStar('political',3)">â˜†</button><button class="star-btn" onclick="setPStar('political',4)">â˜†</button><button class="star-btn" onclick="setPStar('political',5)">â˜†</button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">ì§€ì—­ ì˜í–¥ë ¥</label>
        <div class="star-input" id="pLocalStars">
          <button class="star-btn" onclick="setPStar('local',1)">â˜†</button><button class="star-btn" onclick="setPStar('local',2)">â˜†</button><button class="star-btn" onclick="setPStar('local',3)">â˜†</button><button class="star-btn" onclick="setPStar('local',4)">â˜†</button><button class="star-btn" onclick="setPStar('local',5)">â˜†</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal('addPersonModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="savePerson()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- MEETING MODAL -->
<div class="modal-overlay" id="addMeetingModal">
  <div class="modal">
    <div class="modal-title">ğŸ“ ë§Œë‚¨ ê¸°ë¡ ì¶”ê°€</div>
    <input type="hidden" id="meetingPersonId">
    <div class="form-row">
      <div class="form-group"><label class="form-label">ë‚ ì§œ *</label><input class="form-input" id="mDate" type="date"></div>
      <div class="form-group"><label class="form-label">ì¥ì†Œ</label><input class="form-input" id="mPlace" placeholder="êµ­íšŒì˜ì‚¬ë‹¹ íšŒì˜ì‹¤"></div>
    </div>
    <div class="form-group"><label class="form-label">ë™ì„ì (ì‰¼í‘œ êµ¬ë¶„)</label><input class="form-input" id="mWith" placeholder="ê¹€ì² ìˆ˜, ì´ì˜í¬"></div>
    <div class="form-group"><label class="form-label">ë§Œë‚¨ ë‚´ìš© / ë©”ëª¨</label><textarea class="form-textarea" id="mMemo" placeholder="ë¶„ìœ„ê¸°, ì£¼ìš” ë°œì–¸, ë…¼ì˜ ë‚´ìš©..."></textarea></div>
    <div class="form-group"><label class="form-label">í‰ê°€ / ì†Œê²¬</label><textarea class="form-textarea" id="mEval" style="min-height:56px;" placeholder="ê´€ê³„ ì§„ì „, í–¥í›„ ê³„íš..."></textarea></div>
    <div class="form-group">
      <label class="form-label">ë§Œë‚¨ í‰ì </label>
      <div class="star-input" id="meetingStars">
        <button class="star-btn" onclick="setMStar(1)">â˜†</button><button class="star-btn" onclick="setMStar(2)">â˜†</button><button class="star-btn" onclick="setMStar(3)">â˜†</button><button class="star-btn" onclick="setMStar(4)">â˜†</button><button class="star-btn" onclick="setMStar(5)">â˜†</button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal('addMeetingModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="saveMeeting()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- RELATION MODAL -->
<div class="modal-overlay" id="addRelationModal">
  <div class="modal">
    <div class="modal-title">ğŸ”— ê´€ê³„ ì„¤ì •</div>
    <input type="hidden" id="relFromId">
    <div class="form-group"><label class="form-label">ìƒëŒ€ë°©</label><select class="form-select" id="relToId"></select></div>
    <div class="form-group">
      <label class="form-label">ì¹œë°€ë„ (1~100)</label>
      <input class="form-input" id="relClose" type="range" min="1" max="100" value="50" oninput="document.getElementById('relCloseVal').textContent=this.value" style="padding:6px 0;">
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text3);margin-top:2px;"><span>ì†Œì›</span><span id="relCloseVal">50</span><span>ë§¤ìš° ì¹œë°€</span></div>
    </div>
    <div class="form-group"><label class="form-label">ê´€ê³„ ìœ í˜•</label><select class="form-select" id="relType"><option>ë™ë£Œ</option><option>ì„ í›„ë°°</option><option>ì •ì¹˜ì ë™ì§€</option><option>ê²½ìŸ</option><option>ê°€ì¡±</option><option>ì§€ì¸</option><option>í›„ì›</option></select></div>
    <div class="form-group"><label class="form-label">ë©”ëª¨</label><textarea class="form-textarea" id="relMemo" style="min-height:56px;" placeholder="ê´€ê³„ ë°°ê²½, ê³„ê¸°..."></textarea></div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal('addRelationModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="saveRelation()">ì €ì¥</button>
    </div>
  </div>
</div>


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REGION DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SIDO_SIGUNGU = {
  "ì„œìš¸íŠ¹ë³„ì‹œ":["ì¢…ë¡œêµ¬","ì¤‘êµ¬","ìš©ì‚°êµ¬","ì„±ë™êµ¬","ê´‘ì§„êµ¬","ë™ëŒ€ë¬¸êµ¬","ì¤‘ë‘êµ¬","ì„±ë¶êµ¬","ê°•ë¶êµ¬","ë„ë´‰êµ¬","ë…¸ì›êµ¬","ì€í‰êµ¬","ì„œëŒ€ë¬¸êµ¬","ë§ˆí¬êµ¬","ì–‘ì²œêµ¬","ê°•ì„œêµ¬","êµ¬ë¡œêµ¬","ê¸ˆì²œêµ¬","ì˜ë“±í¬êµ¬","ë™ì‘êµ¬","ê´€ì•…êµ¬","ì„œì´ˆêµ¬","ê°•ë‚¨êµ¬","ì†¡íŒŒêµ¬","ê°•ë™êµ¬"],
  "ë¶€ì‚°ê´‘ì—­ì‹œ":["ì¤‘êµ¬","ì„œêµ¬","ë™êµ¬","ì˜ë„êµ¬","ë¶€ì‚°ì§„êµ¬","ë™ë˜êµ¬","ë‚¨êµ¬","ë¶êµ¬","í•´ìš´ëŒ€êµ¬","ì‚¬í•˜êµ¬","ê¸ˆì •êµ¬","ê°•ì„œêµ¬","ì—°ì œêµ¬","ìˆ˜ì˜êµ¬","ì‚¬ìƒêµ¬","ê¸°ì¥êµ°"],
  "ëŒ€êµ¬ê´‘ì—­ì‹œ":["ì¤‘êµ¬","ë™êµ¬","ì„œêµ¬","ë‚¨êµ¬","ë¶êµ¬","ìˆ˜ì„±êµ¬","ë‹¬ì„œêµ¬","ë‹¬ì„±êµ°","êµ°ìœ„êµ°"],
  "ì¸ì²œê´‘ì—­ì‹œ":["ì¤‘êµ¬","ë™êµ¬","ë¯¸ì¶”í™€êµ¬","ì—°ìˆ˜êµ¬","ë‚¨ë™êµ¬","ë¶€í‰êµ¬","ê³„ì–‘êµ¬","ì„œêµ¬","ê°•í™”êµ°","ì˜¹ì§„êµ°"],
  "ê´‘ì£¼ê´‘ì—­ì‹œ":["ë™êµ¬","ì„œêµ¬","ë‚¨êµ¬","ë¶êµ¬","ê´‘ì‚°êµ¬"],
  "ëŒ€ì „ê´‘ì—­ì‹œ":["ë™êµ¬","ì¤‘êµ¬","ì„œêµ¬","ìœ ì„±êµ¬","ëŒ€ë•êµ¬"],
  "ìš¸ì‚°ê´‘ì—­ì‹œ":["ì¤‘êµ¬","ë‚¨êµ¬","ë™êµ¬","ë¶êµ¬","ìš¸ì£¼êµ°"],
  "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ":["ì„¸ì¢…ì‹œ"],
  "ê²½ê¸°ë„":["ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬","ìˆ˜ì›ì‹œ ê¶Œì„ êµ¬","ìˆ˜ì›ì‹œ íŒ”ë‹¬êµ¬","ìˆ˜ì›ì‹œ ì˜í†µêµ¬","ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬","ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬","ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬","ì˜ì •ë¶€ì‹œ","ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬","ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬","ë¶€ì²œì‹œ","ê´‘ëª…ì‹œ","í‰íƒì‹œ","ë™ë‘ì²œì‹œ","ì•ˆì‚°ì‹œ ìƒë¡êµ¬","ì•ˆì‚°ì‹œ ë‹¨ì›êµ¬","ê³ ì–‘ì‹œ ë•ì–‘êµ¬","ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬","ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬","ê³¼ì²œì‹œ","êµ¬ë¦¬ì‹œ","ë‚¨ì–‘ì£¼ì‹œ","ì˜¤ì‚°ì‹œ","ì‹œí¥ì‹œ","êµ°í¬ì‹œ","ì˜ì™•ì‹œ","í•˜ë‚¨ì‹œ","ìš©ì¸ì‹œ ì²˜ì¸êµ¬","ìš©ì¸ì‹œ ê¸°í¥êµ¬","ìš©ì¸ì‹œ ìˆ˜ì§€êµ¬","íŒŒì£¼ì‹œ","ì´ì²œì‹œ","ì•ˆì„±ì‹œ","ê¹€í¬ì‹œ","í™”ì„±ì‹œ","ê´‘ì£¼ì‹œ","ì–‘ì£¼ì‹œ","í¬ì²œì‹œ","ì—¬ì£¼ì‹œ","ì—°ì²œêµ°","ê°€í‰êµ°","ì–‘í‰êµ°"],
  "ê°•ì›íŠ¹ë³„ìì¹˜ë„":["ì¶˜ì²œì‹œ","ì›ì£¼ì‹œ","ê°•ë¦‰ì‹œ","ë™í•´ì‹œ","íƒœë°±ì‹œ","ì†ì´ˆì‹œ","ì‚¼ì²™ì‹œ","í™ì²œêµ°","íš¡ì„±êµ°","ì˜ì›”êµ°","í‰ì°½êµ°","ì •ì„ êµ°","ì² ì›êµ°","í™”ì²œêµ°","ì–‘êµ¬êµ°","ì¸ì œêµ°","ê³ ì„±êµ°","ì–‘ì–‘êµ°"],
  "ì¶©ì²­ë¶ë„":["ì²­ì£¼ì‹œ ìƒë‹¹êµ¬","ì²­ì£¼ì‹œ ì„œì›êµ¬","ì²­ì£¼ì‹œ í¥ë•êµ¬","ì²­ì£¼ì‹œ ì²­ì›êµ¬","ì¶©ì£¼ì‹œ","ì œì²œì‹œ","ë³´ì€êµ°","ì˜¥ì²œêµ°","ì˜ë™êµ°","ì¦í‰êµ°","ì§„ì²œêµ°","ê´´ì‚°êµ°","ìŒì„±êµ°","ë‹¨ì–‘êµ°"],
  "ì¶©ì²­ë‚¨ë„":["ì²œì•ˆì‹œ ë™ë‚¨êµ¬","ì²œì•ˆì‹œ ì„œë¶êµ¬","ê³µì£¼ì‹œ","ë³´ë ¹ì‹œ","ì•„ì‚°ì‹œ","ì„œì‚°ì‹œ","ë…¼ì‚°ì‹œ","ê³„ë£¡ì‹œ","ë‹¹ì§„ì‹œ","ê¸ˆì‚°êµ°","ë¶€ì—¬êµ°","ì„œì²œêµ°","ì²­ì–‘êµ°","í™ì„±êµ°","ì˜ˆì‚°êµ°","íƒœì•ˆêµ°"],
  "ì „ë¶íŠ¹ë³„ìì¹˜ë„":["ì „ì£¼ì‹œ ì™„ì‚°êµ¬","ì „ì£¼ì‹œ ë•ì§„êµ¬","êµ°ì‚°ì‹œ","ìµì‚°ì‹œ","ì •ìì‹œ","ë‚¨ì›ì‹œ","ê¹€ì œì‹œ","ì™„ì£¼êµ°","ì§„ì•ˆêµ°","ë¬´ì£¼êµ°","ì¥ìˆ˜êµ°","ì„ì‹¤êµ°","ìˆœì°½êµ°","ê³ ì°½êµ°","ë¶€ì•ˆêµ°"],
  "ì „ë¼ë‚¨ë„":["ëª©í¬ì‹œ","ì—¬ìˆ˜ì‹œ","ìˆœì²œì‹œ","ë‚˜ì£¼ì‹œ","ê´‘ì–‘ì‹œ","ë‹´ì–‘êµ°","ê³¡ì„±êµ°","êµ¬ë¡€êµ°","ê³ í¥êµ°","ë³´ì„±êµ°","í™”ìˆœêµ°","ì¥í¥êµ°","ê°•ì§„êµ°","í•´ë‚¨êµ°","ì˜ì•”êµ°","ë¬´ì•ˆêµ°","í•¨í‰êµ°","ì˜ê´‘êµ°","ì¥ì„±êµ°","ì™„ë„êµ°","ì§„ë„êµ°","ì‹ ì•ˆêµ°"],
  "ê²½ìƒë¶ë„":["í¬í•­ì‹œ ë‚¨êµ¬","í¬í•­ì‹œ ë¶êµ¬","ê²½ì£¼ì‹œ","ê¹€ì²œì‹œ","ì•ˆë™ì‹œ","êµ¬ë¯¸ì‹œ","ì˜ì£¼ì‹œ","ì˜ì²œì‹œ","ìƒì£¼ì‹œ","ë¬¸ê²½ì‹œ","ê²½ì‚°ì‹œ","ì˜ì„±êµ°","ì²­ì†¡êµ°","ì˜ì–‘êµ°","ì˜ë•êµ°","ì²­ë„êµ°","ê³ ë ¹êµ°","ì„±ì£¼êµ°","ì¹ ê³¡êµ°","ì˜ˆì²œêµ°","ë´‰í™”êµ°","ìš¸ì§„êµ°","ìš¸ë¦‰êµ°"],
  "ê²½ìƒë‚¨ë„":["ì°½ì›ì‹œ ì˜ì°½êµ¬","ì°½ì›ì‹œ ì„±ì‚°êµ¬","ì°½ì›ì‹œ ë§ˆì‚°í•©í¬êµ¬","ì°½ì›ì‹œ ë§ˆì‚°íšŒì›êµ¬","ì°½ì›ì‹œ ì§„í•´êµ¬","ì§„ì£¼ì‹œ","í†µì˜ì‹œ","ì‚¬ì²œì‹œ","ê¹€í•´ì‹œ","ë°€ì–‘ì‹œ","ê±°ì œì‹œ","ì–‘ì‚°ì‹œ","ì˜ë ¹êµ°","í•¨ì•ˆêµ°","ì°½ë…•êµ°","ê³ ì„±êµ°","ë‚¨í•´êµ°","í•˜ë™êµ°","ì‚°ì²­êµ°","í•¨ì–‘êµ°","ê±°ì°½êµ°","í•©ì²œêµ°"],
  "ì œì£¼íŠ¹ë³„ìì¹˜ë„":["ì œì£¼ì‹œ","ì„œê·€í¬ì‹œ"]
};
const ALL_SIDO = Object.keys(SIDO_SIGUNGU);

const POLITICAL_EVENTS = [
  {id:'election25_support',icon:'ğŸ—³ï¸',label:'25ë…„ ì´ì„  ì§€ì›',color:'#58a6ff'},
  {id:'party_leader',icon:'ğŸ‘‘',label:'ë‹¹ëŒ€í‘œ ì„ ê±° ì§€ì›',color:'#d29922'},
  {id:'local_election',icon:'ğŸ™ï¸',label:'ì§€ë°©ì„ ê±° ì§€ì›',color:'#3fb950'},
  {id:'campaign_team',icon:'ğŸ“£',label:'ì„ ê±°ìš´ë™ì›',color:'#bc8cff'},
  {id:'fundraising',icon:'ğŸ’°',label:'í›„ì›ê¸ˆ ê¸°ì—¬',color:'#e3b341'},
  {id:'media_support',icon:'ğŸ“º',label:'ì–¸ë¡  ì§€ì§€',color:'#39d353'},
  {id:'org_mobilize',icon:'ğŸ“‹',label:'ì¡°ì§ ë™ì›',color:'#f85149'},
  {id:'policy_collab',icon:'ğŸ“œ',label:'ì •ì±… í˜‘ë ¥',color:'#79c0ff'},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="_loadingOverlay" style="position:fixed;inset:0;background:#0d1117;display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column;gap:16px;">
  <div style="font-size:36px;">ğŸ›ï¸</div>
  <div style="font-size:16px;font-family:'Noto Sans KR',sans-serif;color:#e6edf3;font-weight:600;">ì¸ë§¥ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
  <div style="font-size:13px;color:#8b949e;font-family:'Noto Sans KR',sans-serif;">Firebase ì—°ê²° ì¤‘...</div>
  <div style="width:200px;height:3px;background:#21262d;border-radius:2px;overflow:hidden;margin-top:4px;">
    <div style="height:100%;background:linear-gradient(90deg,#1f6feb,#bc8cff);border-radius:2px;animation:ldbar 1.5s ease-in-out infinite;"></div>
  </div>
</div>
<style>@keyframes ldbar{0%{width:0%}60%{width:80%}100%{width:100%}}</style>

<script type="module">
// FIREBASE ì„¤ì • â€” ì•„ë˜ YOUR_FIREBASE_CONFIG_HERE ë¶€ë¶„ì„
// Firebase ì½˜ì†”ì—ì„œ ë³µì‚¬í•œ firebaseConfig ê°ì²´ë¡œ êµì²´í•˜ì„¸ìš”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = YOUR_FIREBASE_CONFIG_HERE;

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, doc, getDoc, setDoc, onSnapshot, deleteDoc }
  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA â€” Firebase Firestore ì‹¤ì‹œê°„ ë™ê¸°í™”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let persons   = [];
let meetings  = [];
let relations = [];
let cats      = {
  parties:['ë¯¼ì£¼ë‹¹','êµ­ë¯¼ì˜í˜','ì •ì˜ë‹¹','ê°œí˜ì‹ ë‹¹','êµ­ë¯¼ì˜ë‹¹','ì§„ë³´ë‹¹','ë¬´ì†Œì†','ê¸°íƒ€'],
  relTypes:['ì •ì¹˜ì¸','ê³µë¬´ì›','ì‹œë¯¼ë‹¨ì²´','ì–¸ë¡ ','ê²½ì œê³„','í•™ê³„','ì¢…êµ','êµ°ì¸','ë²•ì¡°ê³„','ì˜ë£Œê³„','ê¸°íƒ€'],
};

let selectedId=null, currentView='list', filteredPersons=[];
let tempPolStar=0, tempLocStar=0, tempMeetStar=3;
let _dbReady = false;

const AVC=[
  {bg:'rgba(88,166,255,.2)',border:'#58a6ff',text:'#79c0ff'},
  {bg:'rgba(63,185,80,.2)',border:'#3fb950',text:'#56d364'},
  {bg:'rgba(188,140,255,.2)',border:'#bc8cff',text:'#d2a8ff'},
  {bg:'rgba(248,81,73,.2)',border:'#f85149',text:'#ff7b72'},
  {bg:'rgba(210,153,34,.2)',border:'#d29922',text:'#e3b341'},
  {bg:'rgba(57,211,83,.2)',border:'#39d353',text:'#39d353'},
];
const getAC=n=>{let s=0;for(let c of n)s+=c.charCodeAt(0);return AVC[s%AVC.length];};
const genId=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
const starsStr=n=>'â­'.repeat(n)+'â˜†'.repeat(5-n);
const rf=p=>[p.sido,p.sigungu].filter(Boolean).join(' ');

// â”€â”€ Firestore ì €ì¥ â”€â”€
async function save(){
  try {
    await setDoc(doc(db,'app','data'),{persons,meetings,relations,cats,updatedAt:Date.now()});
  } catch(e){ console.error('ì €ì¥ ì˜¤ë¥˜',e); showToast('ì €ì¥ ì‹¤íŒ¨: '+e.message,'error'); }
}

// â”€â”€ í† ìŠ¤íŠ¸ ì•Œë¦¼ â”€â”€
function showToast(msg, type='info'){
  let t=document.getElementById('_toast');
  if(!t){t=document.createElement('div');t.id='_toast';
    t.style.cssText='position:fixed;bottom:24px;left:50%;transform:translateX(-50%);padding:10px 18px;border-radius:8px;font-size:13px;font-family:inherit;z-index:9999;transition:opacity .3s;pointer-events:none;';
    document.body.appendChild(t);}
  t.textContent=msg;
  t.style.background=type==='error'?'#f85149':type==='success'?'#3fb950':'#58a6ff';
  t.style.color='#fff';t.style.opacity='1';
  clearTimeout(t._tid);t._tid=setTimeout(()=>t.style.opacity='0',2800);
}

// â”€â”€ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë‹ â”€â”€
function startRealtimeSync(){
  const ref = doc(db,'app','data');
  onSnapshot(ref, (snap)=>{
    if(snap.exists()){
      const d=snap.data();
      persons  =d.persons   || [];
      meetings =d.meetings  || [];
      relations=d.relations || [];
      if(d.cats)cats=d.cats;
    }
    if(!_dbReady){
      _dbReady=true;
      document.getElementById('_loadingOverlay').style.display='none';
      populateFilters(); populateModal(); renderPersonList();
    } else {
      // ë‹¤ë¥¸ ì‚¬ìš©ì ë³€ê²½ ì‹¤ì‹œê°„ ë°˜ì˜
      renderPersonList();
      if(currentView==='grid') renderGridView();
      if(selectedId) showDetail(selectedId);
      showToast('ğŸ“¡ ë°ì´í„° ë™ê¸°í™”ë¨');
    }
  }, (err)=>{
    console.error('Firestore ì˜¤ë¥˜',err);
    document.getElementById('_loadingOverlay').innerHTML=
      '<div style="text-align:center;color:#f85149;font-size:14px;">âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨<br><span style="font-size:12px;color:#8b949e;">Firebase ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”</span></div>';
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAMPLE DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ìƒ˜í”Œ ë°ì´í„°ëŠ” Firebase ì²« ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤
// (initSampleì€ Firebase ë²„ì „ì—ì„œëŠ” ì„œë²„ì—ì„œ ê´€ë¦¬)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DROPDOWNS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function populateFilters(){
  document.getElementById('filterParty').innerHTML='<option value="">ì „ì²´ ì •ë‹¹</option>'+cats.parties.map(p=>`<option>${p}</option>`).join('');
  document.getElementById('filterSido').innerHTML='<option value="">ì „ì²´ ê´‘ì—­</option>'+ALL_SIDO.map(s=>`<option>${s}</option>`).join('');
  document.getElementById('filterRelType').innerHTML='<option value="">ì „ì²´ ë¶„ë¥˜</option>'+cats.relTypes.map(r=>`<option>${r}</option>`).join('');
}
function populateModal(){
  document.getElementById('pParty').innerHTML='<option value="">-</option>'+cats.parties.map(p=>`<option>${p}</option>`).join('');
  document.getElementById('pRelation').innerHTML='<option value="">-</option>'+cats.relTypes.map(r=>`<option>${r}</option>`).join('');
  document.getElementById('pSido').innerHTML='<option value="">-</option>'+ALL_SIDO.map(s=>`<option>${s}</option>`).join('');
  document.getElementById('pSigungu').innerHTML='<option value="">-</option>';
}
function onPersonSidoChange(){
  const v=document.getElementById('pSido').value;
  document.getElementById('pSigungu').innerHTML='<option value="">-</option>'+(v&&SIDO_SIGUNGU[v]?SIDO_SIGUNGU[v].map(s=>`<option>${s}</option>`).join(''):'');
}
function onSidoFilter(){
  const v=document.getElementById('filterSido').value;
  document.getElementById('filterSigungu').innerHTML='<option value="">ì „ì²´ ì‹œêµ°êµ¬</option>'+(v&&SIDO_SIGUNGU[v]?SIDO_SIGUNGU[v].map(s=>`<option>${s}</option>`).join(''):'');
  applyFilters();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSON LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPersonList(){
  const q=document.getElementById('searchInput').value.toLowerCase();
  const party=document.getElementById('filterParty').value;
  const sido=document.getElementById('filterSido').value;
  const sigungu=document.getElementById('filterSigungu').value;
  const relT=document.getElementById('filterRelType').value;
  const inf=document.getElementById('filterInfluence').value;
  filteredPersons=persons.filter(p=>{
    if(q&&!p.name.toLowerCase().includes(q)&&!(p.company||'').toLowerCase().includes(q)&&
       !(p.party||'').includes(q)&&!(p.sido||'').includes(q)&&!(p.sigungu||'').includes(q))return false;
    if(party&&p.party!==party)return false;
    if(sido&&p.sido!==sido)return false;
    if(sigungu&&p.sigungu!==sigungu)return false;
    if(relT&&p.relation!==relT)return false;
    if(inf&&p.politicalInfluence!==parseInt(inf))return false;
    return true;
  });
  document.getElementById('personCount').textContent=filteredPersons.length+'ëª…';
  const list=document.getElementById('personList');
  if(!filteredPersons.length){list.innerHTML='<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>';return;}
  list.innerHTML=filteredPersons.map(p=>{
    const ac=getAC(p.name);
    const ic=p.politicalInfluence>=4?'#f85149':p.politicalInfluence>=3?'#d29922':'#3fb950';
    const region=rf(p);
    return`<div class="person-item${selectedId===p.id?' active':''}" onclick="selectPerson('${p.id}')">
      <div class="avatar" style="background:${ac.bg};border-color:${ac.border};color:${ac.text}">${p.name.charAt(0)}</div>
      <div class="person-info">
        <div class="person-name">${p.name}</div>
        <div class="person-meta">${[p.party,region,p.duty].filter(Boolean).join(' Â· ')||'â€”'}</div>
      </div>
      <div class="influence-dot" style="background:${ic}" title="ì •ì¹˜ì˜í–¥ë ¥ ${p.politicalInfluence||0}"></div>
    </div>`;
  }).join('');
}
function selectPerson(id){selectedId=id;renderPersonList();if(currentView==='list')showDetail(id);}
function applyFilters(){renderPersonList();if(currentView==='grid')renderGridView();}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showDetail(id){
  const p=persons.find(x=>x.id===id);if(!p)return;
  ['emptyState','gridView','networkView','adminView'].forEach(i=>document.getElementById(i).style.display='none');
  const dv=document.getElementById('detailView');dv.style.display='block';
  const ac=getAC(p.name),pM=meetings.filter(m=>m.personId===id),pR=relations.filter(r=>r.fromId===id||r.toId===id);
  const PC={'ë¯¼ì£¼ë‹¹':'#58a6ff','êµ­ë¯¼ì˜í˜':'#f85149','ì •ì˜ë‹¹':'#3fb950','ê°œí˜ì‹ ë‹¹':'#e3b341','ë¬´ì†Œì†':'#8b949e'};
  const pc=PC[p.party]||'#8b949e';const region=rf(p);
  dv.innerHTML=`<div class="detail-view fade-in">
    <div class="detail-hero">
      <div class="detail-avatar" style="background:${ac.bg};border-color:${ac.border};color:${ac.text}">${p.name.charAt(0)}</div>
      <div style="flex:1;">
        <div class="detail-name">${p.name}</div>
        <div class="detail-role">${[p.company,p.duty].filter(Boolean).join(' Â· ')||'ì†Œì† ë¯¸ì…ë ¥'}</div>
        <div class="tags">
          ${p.party?`<span class="tag" style="background:${pc}22;border-color:${pc}66;color:${pc}">ğŸ›ï¸ ${p.party}</span>`:''}
          ${region?`<span class="tag tag-blue">ğŸ“ ${region}</span>`:''}
          ${p.sex?`<span class="tag tag-blue">${p.sex==='ë‚¨'?'â™‚':'â™€'} ${p.sex}</span>`:''}
          ${p.relation?`<span class="tag tag-purple">${p.relation}</span>`:''}
          ${p.birth?`<span class="tag tag-yellow">ğŸ‚ ${p.birth}</span>`:''}
          ${p.phone?`<span class="tag tag-green">ğŸ“± ${p.phone}</span>`:''}
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:5px;align-items:flex-end;flex-shrink:0;">
        <button class="btn btn-primary" onclick="openEditModal('${p.id}')">âœï¸ ìˆ˜ì •</button>
        <button class="btn btn-green" onclick="openMeetingModal('${p.id}')">ï¼‹ ë§Œë‚¨ ê¸°ë¡</button>
        <button class="btn" onclick="openRelationModal('${p.id}')">ğŸ”— ê´€ê³„ ì„¤ì •</button>
        <button class="btn btn-red" onclick="deletePerson('${p.id}')">ğŸ—‘ ì‚­ì œ</button>
      </div>
    </div>
    ${p.memo?`<div style="background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:12px 16px;margin-bottom:16px;font-size:13px;line-height:1.7;color:var(--text2);">ğŸ’¬ ${p.memo}</div>`:''}
    <div class="section-card">
      <div class="section-title">ğŸ“Š ì˜í–¥ë ¥ ì§€í‘œ</div>
      <div class="influence-grid">
        ${[{l:'ì •ì¹˜ì  ì˜í–¥ë ¥',v:p.politicalInfluence||0,g:'#f85149,#ff7b72',c:'var(--red)'},
           {l:'ì§€ì—­ ì˜í–¥ë ¥',v:p.localInfluence||0,g:'#3fb950,#56d364',c:'var(--green)'},
           {l:'ë§Œë‚¨ íšŸìˆ˜',v:Math.min(pM.length,5),d:pM.length+'íšŒ',g:'#58a6ff,#79c0ff',c:'var(--accent)'},
           {l:'ê´€ê³„ ë„¤íŠ¸ì›Œí¬',v:Math.min(pR.length,5),d:pR.length+'ëª…',g:'#bc8cff,#d2a8ff',c:'var(--purple)'}
        ].map(i=>`<div class="influence-item">
          <div class="influence-label">${i.l}</div>
          <div class="influence-bar"><div class="influence-fill" style="width:${i.v*20}%;background:linear-gradient(90deg,${i.g})"></div></div>
          <div class="influence-value"><span>${i.d||starsStr(i.v)}</span><span style="color:${i.c}">${i.d||i.v+'/5'}</span></div>
        </div>`).join('')}
      </div>
    </div>
    <div class="section-card">
      <div class="section-title">ğŸ—³ï¸ ì •ì¹˜ í™œë™ ì´ë ¥ <span style="font-size:11px;font-weight:400;text-transform:none;color:var(--text3);">í´ë¦­í•˜ì—¬ ON/OFF</span></div>
      <div class="events-grid">
        ${POLITICAL_EVENTS.map(ev=>{const active=(p.events||[]).includes(ev.id);
          return`<div class="event-badge ${active?'active':''}" style="background:${active?ev.color+'22':'var(--bg3)'};border-color:${active?ev.color:'var(--border)'};color:${active?ev.color:'var(--text3)'};" onclick="toggleEvent('${p.id}','${ev.id}')">${ev.icon} ${ev.label}</div>`;
        }).join('')}
      </div>
    </div>
    <div class="section-card">
      <div class="section-title">ğŸ”— ê´€ê³„ í˜„í™©</div>
      ${!pR.length?'<div style="color:var(--text3);font-size:13px;">ë“±ë¡ëœ ê´€ê³„ ì—†ìŒ</div>':
        pR.map(r=>{const oId=r.fromId===id?r.toId:r.fromId;const o=persons.find(x=>x.id===oId);if(!o)return'';
          return`<div class="relation-item">
            <div class="rel-name" onclick="selectPerson('${o.id}')">${o.name}</div>
            <div class="closeness-track" onclick="editCloseness('${r.id}',event)"><div class="closeness-fill" style="width:${r.closeness}%"></div></div>
            <div class="closeness-value">${r.closeness}%</div>
            <span class="tag tag-purple" style="font-size:11px;padding:2px 7px;">${r.type}</span>
            <button class="btn btn-sm" onclick="deleteRelation('${r.id}')">ì‚­ì œ</button>
          </div>`;}).join('')}
    </div>
    <div class="section-card">
      <div class="section-title">ğŸ“… ë§Œë‚¨ ê¸°ë¡</div>
      ${!pM.length?'<div style="color:var(--text3);font-size:13px;">ì•„ì§ ë§Œë‚¨ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>':
        pM.sort((a,b)=>b.date.localeCompare(a.date)).map(m=>`<div class="meeting-card">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div class="meeting-date">ğŸ“… ${m.date}</div>
            <div style="display:flex;align-items:center;gap:8px;"><span>${'â­'.repeat(m.rating||0)}</span><button class="btn btn-sm" onclick="deleteMeeting('${m.id}')">ì‚­ì œ</button></div>
          </div>
          <div class="meeting-details">
            ${m.place?`<div class="meeting-detail-item">ğŸ“ ${m.place}</div>`:''}
            ${m.with?`<div class="meeting-detail-item">ğŸ‘¥ ë™ì„: ${m.with}</div>`:''}
          </div>
          ${m.memo?`<div class="meeting-memo">${m.memo}</div>`:''}
          ${m.eval?`<div class="meeting-eval">ğŸ’¡ í‰ê°€: ${m.eval}</div>`:''}
        </div>`).join('')}
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GRID VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGridView(){
  const gv=document.getElementById('gridView');gv.style.display='grid';
  const PC={'ë¯¼ì£¼ë‹¹':'#58a6ff','êµ­ë¯¼ì˜í˜':'#f85149','ì •ì˜ë‹¹':'#3fb950','ë¬´ì†Œì†':'#8b949e'};
  gv.innerHTML=filteredPersons.map(p=>{
    const ac=getAC(p.name),pc=PC[p.party]||'#8b949e',region=rf(p);
    return`<div class="grid-card" onclick="selectPerson('${p.id}');switchView('list')">
      <div class="grid-card-header">
        <div class="avatar" style="background:${ac.bg};border-color:${ac.border};color:${ac.text}">${p.name.charAt(0)}</div>
        <div><div style="font-size:14px;font-weight:600">${p.name}</div><div style="font-size:11px;color:var(--text2)">${p.duty||'ì§ì±…ë¯¸ìƒ'}</div></div>
      </div>
      <div style="font-size:12px;color:var(--text2);margin-bottom:8px;">${p.company||'ì†Œì†ë¯¸ìƒ'}</div>
      <div class="tags" style="margin-bottom:8px;">
        ${p.party?`<span class="tag" style="background:${pc}22;border-color:${pc}55;color:${pc};padding:1px 7px;">${p.party}</span>`:''}
        ${region?`<span class="tag tag-blue" style="padding:1px 7px;">${region}</span>`:''}
        ${p.relation?`<span class="tag tag-purple" style="padding:1px 7px;">${p.relation}</span>`:''}
      </div>
      <div style="font-size:11px;color:var(--text3);display:flex;gap:10px;margin-bottom:6px;">
        <span>ì •ì¹˜: ${starsStr(p.politicalInfluence||0)}</span><span>ì§€ì—­: ${starsStr(p.localInfluence||0)}</span>
      </div>
      ${(p.events||[]).length?`<div style="font-size:15px;">${p.events.map(e=>POLITICAL_EVENTS.find(x=>x.id===e)?.icon||'').join(' ')}</div>`:''}
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NETWORK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let netNodes=[],netEdges=[],netDrag=null,netOffX=0,netOffY=0,netScale=1,isPan=false,panS=null,nMX=0,nMY=0;
function renderNetwork(){
  const nv=document.getElementById('networkView');nv.style.display='flex';
  const c=document.getElementById('networkCanvas');c.width=nv.offsetWidth;c.height=nv.offsetHeight;
  netNodes=persons.map((p,i)=>{const a=(i/persons.length)*Math.PI*2,r=Math.min(c.width,c.height)*.32;
    return{id:p.id,name:p.name,x:c.width/2+Math.cos(a)*r,y:c.height/2+Math.sin(a)*r,size:8+(p.politicalInfluence||0)*3,color:getAC(p.name)};});
  netEdges=relations.map(r=>({from:r.fromId,to:r.toId,closeness:r.closeness,type:r.type}));
  drawNet();
  c.onmousedown=e=>{const pos=mp(c,e);const n=nodeAt(pos.x,pos.y);if(n){netDrag=n;nMX=pos.x-n.x;nMY=pos.y-n.y;}else{isPan=true;panS={x:e.clientX-netOffX,y:e.clientY-netOffY};}c.style.cursor='grabbing';};
  c.onmousemove=e=>{const pos=mp(c,e);if(netDrag){netDrag.x=pos.x-nMX;netDrag.y=pos.y-nMY;drawNet();}
    else if(isPan){netOffX=e.clientX-panS.x;netOffY=e.clientY-panS.y;drawNet();}
    else{const n=nodeAt(pos.x,pos.y);const tt=document.getElementById('netTooltip');
      if(n){const p=persons.find(x=>x.id===n.id);tt.style.display='block';tt.style.left=(e.offsetX+14)+'px';tt.style.top=(e.offsetY+14)+'px';tt.textContent=`${n.name} | ${p?.party||'ë¬´ì†Œì†'} | ${rf(p||{})}`;c.style.cursor='pointer';}
      else{tt.style.display='none';c.style.cursor='grab';}}};
  c.onmouseup=()=>{netDrag=null;isPan=false;c.style.cursor='grab';};
  c.onclick=e=>{const pos=mp(c,e);const n=nodeAt(pos.x,pos.y);if(n){selectedId=n.id;switchView('list');}};
  c.onwheel=e=>{e.preventDefault();netScale=Math.max(.3,Math.min(3,netScale*(e.deltaY>0?.9:1.1)));drawNet();};
}
const mp=(c,e)=>{const r=c.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top};};
const nodeAt=(mx,my)=>{for(const n of netNodes){const dx=mx-(n.x*netScale+netOffX),dy=my-(n.y*netScale+netOffY);if(Math.sqrt(dx*dx+dy*dy)<n.size*netScale+5)return n;}return null;};
function drawNet(){
  const c=document.getElementById('networkCanvas'),ctx=c.getContext('2d');
  ctx.clearRect(0,0,c.width,c.height);ctx.save();ctx.translate(netOffX,netOffY);ctx.scale(netScale,netScale);
  netEdges.forEach(e=>{const a=netNodes.find(n=>n.id===e.from),b=netNodes.find(n=>n.id===e.to);if(!a||!b)return;
    const al=.1+(e.closeness/100)*.7;ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);
    ctx.strokeStyle=`rgba(88,166,255,${al})`;ctx.lineWidth=.5+(e.closeness/100)*3;ctx.stroke();
    ctx.fillStyle=`rgba(88,166,255,${al+.1})`;ctx.font='10px sans-serif';ctx.fillText(e.closeness+'%',(a.x+b.x)/2,(a.y+b.y)/2);});
  netNodes.forEach(n=>{const sel=selectedId===n.id;
    ctx.beginPath();ctx.arc(n.x,n.y,n.size+(sel?4:0),0,Math.PI*2);ctx.fillStyle=sel?n.color.border:n.color.bg;ctx.fill();
    ctx.strokeStyle=n.color.border;ctx.lineWidth=sel?3:1.5;ctx.stroke();
    ctx.fillStyle=n.color.text;ctx.font=`${sel?13:11}px "Noto Sans KR",sans-serif`;ctx.textAlign='center';ctx.fillText(n.name,n.x,n.y+n.size+14);});
  ctx.restore();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let openSido=null;
function renderAdmin(){
  const av=document.getElementById('adminView');av.style.display='block';
  const mkSec=(key,title,icon)=>`<div class="admin-card">
    <div class="admin-card-title">${icon} ${title}</div>
    <div class="tag-list">${(cats[key]||[]).map((v,i)=>`<div class="editable-tag"><span>${v}</span><button class="del-btn" onclick="delCat('${key}',${i})">Ã—</button></div>`).join('')}</div>
    <div class="add-tag-row">
      <input class="add-tag-input" id="ai_${key}" placeholder="${title} í•­ëª© ì¶”ê°€..." onkeydown="if(event.key==='Enter')addCat('${key}')">
      <button class="btn btn-primary" style="font-size:12px;padding:6px 12px;" onclick="addCat('${key}')">ï¼‹ ì¶”ê°€</button>
    </div>
  </div>`;

  const sidoBlocks=ALL_SIDO.map(s=>{const isOpen=openSido===s;
    return`<div class="sido-chip ${isOpen?'open':''}" onclick="toggleSido('${s}')">
      <div class="sido-chip-name">${s}</div>
      <div class="sido-chip-count">${SIDO_SIGUNGU[s].length}ê°œ ì‹œÂ·êµ°Â·êµ¬</div>
      ${isOpen?`<div class="sigungu-list">${SIDO_SIGUNGU[s].map(sg=>`<span class="sigungu-item">${sg}</span>`).join('')}</div>`:''}
    </div>`;}).join('');

  av.innerHTML=`<div class="admin-wrap">
    <div class="admin-page-title">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</div>
    <div class="admin-page-sub">ì •ë‹¹, ê´€ê³„ ë¶„ë¥˜ ë“± ë“œë¡­ë‹¤ìš´ í•­ëª©ì„ í¸ì§‘í•©ë‹ˆë‹¤. ë³€ê²½ì‚¬í•­ì€ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
    <div class="admin-sections">${mkSec('parties','ì •ë‹¹ ëª©ë¡','ğŸ›ï¸')}${mkSec('relTypes','ê´€ê³„ ë¶„ë¥˜','ğŸ”–')}</div>

    <div class="divider"></div>
    <div style="margin-bottom:14px;">
      <div style="font-size:14px;font-weight:700;margin-bottom:4px;">ğŸ“ ì§€ì—­ ë°ì´í„° â€” ê¸°ì´ˆì§€ë°©ìì¹˜ë‹¨ì²´</div>
      <div style="font-size:13px;color:var(--text2);margin-bottom:12px;">ì´ ${Object.values(SIDO_SIGUNGU).flat().length}ê°œ ê¸°ì´ˆìì¹˜ë‹¨ì²´ ë‚´ì¥. í´ë¦­í•˜ë©´ ì‹œÂ·êµ°Â·êµ¬ ëª©ë¡ì´ í¼ì³ì§‘ë‹ˆë‹¤.</div>
      <div class="region-preview-grid">${sidoBlocks}</div>
    </div>

    <div class="divider"></div>
    <div>
      <div style="font-size:14px;font-weight:700;margin-bottom:12px;">ğŸ—„ï¸ ë°ì´í„° ê´€ë¦¬</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;">
        <button class="btn" onclick="exportData()">ğŸ“¥ JSON ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn" onclick="document.getElementById('importFile').click()">ğŸ“¤ JSON ê°€ì ¸ì˜¤ê¸°</button>
        <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
        <button class="btn btn-red" onclick="clearAll()">ğŸ—‘ ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
      <div style="padding:12px 16px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;font-size:13px;color:var(--text2);">
        ì¸ë¬¼ <strong style="color:var(--text)">${persons.length}ëª…</strong> Â· ë§Œë‚¨ ê¸°ë¡ <strong style="color:var(--text)">${meetings.length}ê±´</strong> Â· ê´€ê³„ ì„¤ì • <strong style="color:var(--text)">${relations.length}ê±´</strong>
      </div>
    </div>
  </div>`;
}
function toggleSido(s){openSido=openSido===s?null:s;renderAdmin();}
function addCat(key){const inp=document.getElementById('ai_'+key);const v=inp.value.trim();if(!v)return;if(!cats[key].includes(v))cats[key].push(v);inp.value='';save();renderAdmin();populateFilters();populateModal();}
function delCat(key,idx){cats[key].splice(idx,1);save();renderAdmin();populateFilters();populateModal();}
function exportData(){
  const blob=new Blob([JSON.stringify({persons,meetings,relations,cats},null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='ì¸ë§¥ê´€ë¦¬_'+new Date().toISOString().slice(0,10)+'.json';a.click();
}
function importData(e){
  const f=e.target.files[0];if(!f)return;
  const fr=new FileReader();fr.onload=ev=>{try{const d=JSON.parse(ev.target.result);
    if(d.persons)persons=d.persons;if(d.meetings)meetings=d.meetings;
    if(d.relations)relations=d.relations;if(d.cats)cats=d.cats;
    save();renderPersonList();populateFilters();populateModal();renderAdmin();alert('ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!');}
  catch{alert('ì˜¬ë°”ë¥¸ JSON íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');}};fr.readAsText(f);
}
async function clearAll(){if(!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆê¹Œ? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'))return;persons=[];meetings=[];relations=[];await save();selectedId=null;renderPersonList();renderAdmin();showToast('ì´ˆê¸°í™” ì™„ë£Œ','success');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW SWITCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchView(view){
  currentView=view;
  document.querySelectorAll('.view-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+view).classList.add('active');
  const sb=document.getElementById('sidebarEl');
  sb.style.display=(view==='network'||view==='admin')?'none':'';
  ['emptyState','detailView','gridView','networkView','adminView'].forEach(i=>document.getElementById(i).style.display='none');
  if(view==='list'){if(selectedId)showDetail(selectedId);else document.getElementById('emptyState').style.display='flex';}
  else if(view==='grid'){renderPersonList();renderGridView();}
  else if(view==='network')renderNetwork();
  else if(view==='admin')renderAdmin();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id){document.getElementById(id).classList.add('show');}
function closeModal(id){document.getElementById(id).classList.remove('show');}
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('show');}));

function openAddPersonModal(){
  document.getElementById('editPersonId').value='';
  ['pName','pCompany','pDuty','pPhone','pMemo'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('pSex').value='';document.getElementById('pBirth').value='';
  document.getElementById('pParty').value='';document.getElementById('pRelation').value='';
  document.getElementById('pSido').value='';document.getElementById('pSigungu').innerHTML='<option value="">-</option>';
  tempPolStar=0;tempLocStar=0;updateStarUI('pPoliticalStars',0);updateStarUI('pLocalStars',0);
  document.getElementById('personModalTitle').textContent='ğŸ‘¤ ì¸ë¬¼ ì¶”ê°€';
  openModal('addPersonModal');
}
function openEditModal(id){
  const p=persons.find(x=>x.id===id);if(!p)return;
  document.getElementById('editPersonId').value=p.id;
  document.getElementById('pName').value=p.name||'';document.getElementById('pCompany').value=p.company||'';
  document.getElementById('pDuty').value=p.duty||'';document.getElementById('pPhone').value=p.phone||'';
  document.getElementById('pMemo').value=p.memo||'';document.getElementById('pSex').value=p.sex||'';
  document.getElementById('pBirth').value=p.birth||'';document.getElementById('pParty').value=p.party||'';
  document.getElementById('pRelation').value=p.relation||'';document.getElementById('pSido').value=p.sido||'';
  if(p.sido&&SIDO_SIGUNGU[p.sido]){
    document.getElementById('pSigungu').innerHTML='<option value="">-</option>'+SIDO_SIGUNGU[p.sido].map(s=>`<option>${s}</option>`).join('');
    document.getElementById('pSigungu').value=p.sigungu||'';
  }else document.getElementById('pSigungu').innerHTML='<option value="">-</option>';
  tempPolStar=p.politicalInfluence||0;tempLocStar=p.localInfluence||0;
  updateStarUI('pPoliticalStars',tempPolStar);updateStarUI('pLocalStars',tempLocStar);
  document.getElementById('personModalTitle').textContent='âœï¸ ì¸ë¬¼ ìˆ˜ì •';
  openModal('addPersonModal');
}
function setPStar(type,val){if(type==='political'){tempPolStar=val;updateStarUI('pPoliticalStars',val);}else{tempLocStar=val;updateStarUI('pLocalStars',val);}}
function updateStarUI(id,val){document.getElementById(id).querySelectorAll('.star-btn').forEach((b,i)=>b.textContent=i<val?'â­':'â˜†');}
function savePerson(){
  const name=document.getElementById('pName').value.trim();if(!name){alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');return;}
  const editId=document.getElementById('editPersonId').value;
  const data={name,company:document.getElementById('pCompany').value,duty:document.getElementById('pDuty').value,
    phone:document.getElementById('pPhone').value,memo:document.getElementById('pMemo').value,
    sex:document.getElementById('pSex').value,birth:document.getElementById('pBirth').value,
    party:document.getElementById('pParty').value,relation:document.getElementById('pRelation').value,
    sido:document.getElementById('pSido').value,sigungu:document.getElementById('pSigungu').value,
    politicalInfluence:tempPolStar,localInfluence:tempLocStar};
  if(editId){const p=persons.find(x=>x.id===editId);if(p)Object.assign(p,data);}
  else persons.push({id:genId(),...data,events:[],createdAt:new Date().toISOString()});
  save();closeModal('addPersonModal');renderPersonList();
  if(editId&&selectedId===editId)showDetail(editId);
}
function deletePerson(id){
  if(!confirm('ì´ ì¸ë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  persons=persons.filter(p=>p.id!==id);meetings=meetings.filter(m=>m.personId!==id);relations=relations.filter(r=>r.fromId!==id&&r.toId!==id);
  save();selectedId=null;renderPersonList();document.getElementById('detailView').style.display='none';document.getElementById('emptyState').style.display='flex';
}
function openMeetingModal(pid){
  document.getElementById('meetingPersonId').value=pid;document.getElementById('mDate').value=new Date().toISOString().slice(0,10);
  ['mPlace','mWith','mMemo','mEval'].forEach(id=>document.getElementById(id).value='');
  tempMeetStar=3;updateStarUI('meetingStars',3);openModal('addMeetingModal');
}
function setMStar(val){tempMeetStar=val;updateStarUI('meetingStars',val);}
function saveMeeting(){
  const pid=document.getElementById('meetingPersonId').value,date=document.getElementById('mDate').value;
  if(!date){alert('ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”');return;}
  meetings.push({id:genId(),personId:pid,date,place:document.getElementById('mPlace').value,
    with:document.getElementById('mWith').value,memo:document.getElementById('mMemo').value,
    eval:document.getElementById('mEval').value,rating:tempMeetStar,createdAt:new Date().toISOString()});
  save();closeModal('addMeetingModal');if(selectedId===pid)showDetail(pid);
}
function deleteMeeting(id){if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;meetings=meetings.filter(m=>m.id!==id);save();showDetail(selectedId);}
function openRelationModal(fromId){
  document.getElementById('relFromId').value=fromId;
  document.getElementById('relToId').innerHTML=persons.filter(p=>p.id!==fromId).map(p=>`<option value="${p.id}">${p.name} (${p.party||'ë¬´ì†Œì†'} / ${rf(p)||'ì§€ì—­ë¯¸ìƒ'})</option>`).join('');
  document.getElementById('relClose').value=50;document.getElementById('relCloseVal').textContent=50;document.getElementById('relMemo').value='';
  openModal('addRelationModal');
}
function saveRelation(){
  const fromId=document.getElementById('relFromId').value,toId=document.getElementById('relToId').value;
  const dup=relations.find(r=>(r.fromId===fromId&&r.toId===toId)||(r.fromId===toId&&r.toId===fromId));
  if(dup){if(!confirm('ì´ë¯¸ ê´€ê³„ê°€ ìˆìŠµë‹ˆë‹¤. ì—…ë°ì´íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;relations=relations.filter(r=>r.id!==dup.id);}
  relations.push({id:genId(),fromId,toId,closeness:parseInt(document.getElementById('relClose').value),
    type:document.getElementById('relType').value,memo:document.getElementById('relMemo').value});
  save();closeModal('addRelationModal');showDetail(selectedId);
}
function deleteRelation(id){if(!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;relations=relations.filter(r=>r.id!==id);save();showDetail(selectedId);}
function editCloseness(rId,event){
  const r=relations.find(x=>x.id===rId);if(!r)return;
  const rect=event.currentTarget.getBoundingClientRect();
  r.closeness=Math.max(1,Math.min(100,Math.round(((event.clientX-rect.left)/rect.width)*100)));
  save();showDetail(selectedId);
}
function toggleEvent(pid,evId){
  const p=persons.find(x=>x.id===pid);if(!p)return;if(!p.events)p.events=[];
  const i=p.events.indexOf(evId);if(i>=0)p.events.splice(i,1);else p.events.push(evId);
  save();showDetail(pid);
}

document.getElementById('searchInput').addEventListener('input',()=>{renderPersonList();if(currentView==='grid')renderGridView();});

// INIT â€” Firebase ì‹¤ì‹œê°„ ë™ê¸°í™” ì‹œì‘
startRealtimeSync();

</script>
</body>
</html>
